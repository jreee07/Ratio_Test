<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>⚡ Ratio Test Calculator ⚡</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">

  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-2xl">
    <h1 class="text-3xl font-bold text-center mb-6 text-red-600">⚡ Ratio Test Calculator ⚡</h1>

    <!-- Select PT Ratio -->
    <label class="block mb-2 font-medium">Select PT Ratio</label>
    <select id="ptRatio" class="w-full border rounded-lg p-2 mb-4">
      <option value="11000/110">11000/110</option>
      <option value="33000/110">33000/110</option>
      <option value="240/240">240/240 LT CT</option>
    </select>

    <!-- Transformer Side -->
    <label class="block mb-2 font-medium">Transformer Current Measuring Side</label>
    <select id="side" class="w-full border rounded-lg p-2 mb-4">
      <option value="LT">LT Side</option>
      <option value="HT">HT Side</option>
    </select>

    <!-- Billing OMF -->
    <label class="block mb-2 font-medium">Billing OMF</label>
    <input type="number" id="billingOMF" class="w-full border rounded-lg p-2 mb-4" placeholder="Enter Billing OMF">

    <!-- Clamp Currents -->
    <label class="block mb-2 font-medium">Clamp Meter Currents</label>
    <div class="grid grid-cols-3 gap-2 mb-4">
      <input type="number" id="clamp1" class="border rounded-lg p-2" placeholder="Transformer Current R">
      <input type="number" id="clamp2" class="border rounded-lg p-2" placeholder="Transformer Current Y">
      <input type="number" id="clamp3" class="border rounded-lg p-2" placeholder="Transformer Current B">
    </div>

    <!-- Energy Meter Currents -->
    <label class="block mb-2 font-medium">Energy Meter Current</label>
    <div class="grid grid-cols-3 gap-2 mb-4">
      <input type="number" id="meter1" class="border rounded-lg p-2" placeholder="Meter Current r">
      <input type="number" id="meter2" class="border rounded-lg p-2" placeholder="Meter Current y">
      <input type="number" id="meter3" class="border rounded-lg p-2" placeholder="Meter Current b">
    </div>

    <!-- Calculate Button -->
    <button onclick="calculate()" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">Calculate</button>

    <!-- Results -->
    <div id="results" class="mt-10 hidden">
      <div class="border-t pt-6 space-y-4">
        <div class="grid grid-cols-1 gap-4 text-center">
          <div class="bg-gray-100 py-2 rounded-lg shadow">
            <strong>🧲 Average Transformer Current:</strong> <span id="avgClamp"></span> A
          </div>
          <div class="bg-gray-100 py-2 rounded-lg shadow">
            <strong>📟 Average Meter Current:</strong> <span id="avgMeter"></span> A
          </div>
          <div class="bg-blue-100 py-2 rounded-lg shadow">
            <strong>🧮 Calculated Meter Current:</strong> <span id="calcMeter"></span> A
          </div>
          <div class="bg-yellow-200 py-2 rounded-lg shadow text-yellow-900 font-semibold">
            📉 <strong>Difference:</strong> <span id="diff"></span> A
          </div>
        </div>
        <div class="text-center mt-6">
          <div id="commentBox" class="bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg inline-block"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function calculate() {
      const ptRatio = document.getElementById("ptRatio").value;
      const side = document.getElementById("side").value;
      const billingOMF = parseFloat(document.getElementById("billingOMF").value);

      const clampValues = [
        parseFloat(document.getElementById("clamp1").value) || 0,
        parseFloat(document.getElementById("clamp2").value) || 0,
        parseFloat(document.getElementById("clamp3").value) || 0
      ];
      const meterValues = [
        parseFloat(document.getElementById("meter1").value) || 0,
        parseFloat(document.getElementById("meter2").value) || 0,
        parseFloat(document.getElementById("meter3").value) || 0
      ];

      const avgClamp = average(clampValues);
      const avgMeter = average(meterValues);

      const factors = {
        "11000/110": { LT: 100 / 26.5, HT: 100 },
        "33000/110": { LT: 300 / 79.5, HT: 300 },
        "240/240": { LT: 1, HT: 1 }
      };

      const factor = factors[ptRatio]?.[side];
      if (!factor || isNaN(billingOMF) || billingOMF <= 0) {
        showError("⚠️ Please enter valid inputs for all fields.");
        return;
      }

      const calcMeterCurrent = avgClamp * factor / billingOMF;
      const difference = avgMeter - calcMeterCurrent;

      const comment = Math.abs(difference) <= 0.07
        ? "✅ আলহামদুলিল্লাহ, সব কিছু ঠিক আছে ✅"
        : "⚠️ কাম সারছে, ভালো করে চেক করতে হবে, মনে হচ্ছে বিলিং ওএমএফ ঠিক নাই ⚠️";

      // Show results
      document.getElementById("results").classList.remove("hidden");
      document.getElementById("avgClamp").textContent = avgClamp.toFixed(2);
      document.getElementById("avgMeter").textContent = avgMeter.toFixed(2);
      document.getElementById("calcMeter").textContent = calcMeterCurrent.toFixed(2);
      document.getElementById("diff").textContent = difference.toFixed(2);
      document.getElementById("commentBox").textContent = comment;
    }

    function average(arr) {
      return arr.reduce((sum, val) => sum + val, 0) / arr.length;
    }

    function showError(message) {
      const results = document.getElementById("results");
      results.classList.remove("hidden");
      results.innerHTML = `<p class="text-red-600 font-semibold text-center">${message}</p>`;
    }
  </script>

</body>
</html>