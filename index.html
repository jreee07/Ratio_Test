
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>⚡ Ratio Test Calculator ⚡</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-5xl">

    <h1 class="text-3xl font-bold text-center mb-6 text-red-600">⚡ Ratio Test Calculator ⚡</h1>

    <!-- Header -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
      <div>
        <label for="dateTime" class="block mb-1 font-medium">Date & Time</label>
        <input id="dateTime" type="text" class="w-full border rounded-lg p-2 text-sm bg-gray-50" readonly />
      </div>
      <div class="md:col-span-2">
        <label for="meterNumber" class="block mb-1 font-medium">Meter Number <span class="text-red-500">*</span></label>
        <input id="meterNumber" type="text" class="w-full border rounded-lg p-2 text-sm" placeholder="Enter meter number" />
      </div>
    </div>

    <!-- PT Ratio -->
    <label class="block mb-2 font-medium">Select PT Ratio</label>
    <select id="ptRatio" class="w-full border rounded-lg p-2 mb-4 text-sm">
      <option value="11000/110">11000/110</option>
      <option value="33000/110">33000/110</option>
      <option value="240/240">240/240 LT CT</option>
    </select>

    <!-- Transformer Side -->
    <label class="block mb-2 font-medium">Transformer Current Measuring Side</label>
    <select id="side" class="w-full border rounded-lg p-2 mb-4 text-sm" onchange="updateClampLabels()">
      <option value="LT">LT Side</option>
      <option value="HT">HT Side</option>
    </select>

    <!-- Billing OMF -->
    <label class="block mb-2 font-medium">Billing OMF</label>
    <input type="number" id="billingOMF" class="w-full border rounded-lg p-2 mb-6 text-sm" placeholder="Enter Billing OMF">

    <!-- Transformer Currents -->
    <label id="clampLabel" class="block mb-2 font-medium">Transformer Current (Enter 4 values per phase)</label>
    <div class="space-y-3 mb-6">
      <!-- R Phase -->
      <div>
        <span class="font-semibold">R Phase:</span>
        <div class="grid grid-cols-4 gap-2 mt-1">
          <input type="number" id="clampR1" class="border rounded-lg p-2 text-sm" placeholder="R1">
          <input type="number" id="clampR2" class="border rounded-lg p-2 text-sm" placeholder="R2">
          <input type="number" id="clampR3" class="border rounded-lg p-2 text-sm" placeholder="R3">
          <input type="number" id="clampR4" class="border rounded-lg p-2 text-sm" placeholder="R4">
        </div>
      </div>
      <!-- Y Phase -->
      <div>
        <span class="font-semibold">Y Phase:</span>
        <div class="grid grid-cols-4 gap-2 mt-1">
          <input type="number" id="clampY1" class="border rounded-lg p-2 text-sm" placeholder="Y1">
          <input type="number" id="clampY2" class="border rounded-lg p-2 text-sm" placeholder="Y2">
          <input type="number" id="clampY3" class="border rounded-lg p-2 text-sm" placeholder="Y3">
          <input type="number" id="clampY4" class="border rounded-lg p-2 text-sm" placeholder="Y4">
        </div>
      </div>
      <!-- B Phase -->
      <div>
        <span class="font-semibold">B Phase:</span>
        <div class="grid grid-cols-4 gap-2 mt-1">
          <input type="number" id="clampB1" class="border rounded-lg p-2 text-sm" placeholder="B1">
          <input type="number" id="clampB2" class="border rounded-lg p-2 text-sm" placeholder="B2">
          <input type="number" id="clampB3" class="border rounded-lg p-2 text-sm" placeholder="B3">
          <input type="number" id="clampB4" class="border rounded-lg p-2 text-sm" placeholder="B4">
        </div>
      </div>
    </div>

    <!-- Meter Currents (1 per phase) -->
    <label class="block mb-2 font-medium">Input Meter Current</label>
    <div class="grid grid-cols-3 gap-2 mb-6">
      <input type="number" id="meter1" class="border rounded-lg p-2 text-sm" placeholder="R">
      <input type="number" id="meter2" class="border rounded-lg p-2 text-sm" placeholder="Y">
      <input type="number" id="meter3" class="border rounded-lg p-2 text-sm" placeholder="B">
    </div>

    <!-- Buttons -->
    <div class="flex space-x-2 mb-6">
      <button onclick="calculate()" class="flex-1 bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">Calculate</button>
      <button onclick="resetForm()" class="flex-1 bg-gradient-to-r from-red-400 to-red-600 text-white font-semibold py-3 rounded-lg shadow-lg hover:from-red-500 hover:to-red-700 transition">Reset</button>
    </div>

    <!-- Results -->
    <div id="results" class="mt-10 hidden">
      <div class="border-t pt-6 space-y-4 text-center">
        <div class="bg-gray-100 py-2 rounded-lg shadow">
          <strong>🧲 Transformer Phase Sums (R,Y,B):</strong> <span id="sumClamp"></span> A
        </div>
        <div class="bg-gray-100 py-2 rounded-lg shadow">
          <strong>⚡ Average Transformer Current:</strong> <span id="avgClamp"></span> A
        </div>
        <div class="bg-gray-100 py-2 rounded-lg shadow">
          <strong>📟 Average Meter Current:</strong> <span id="avgMeter"></span> A
        </div>
        <div class="bg-blue-100 py-2 rounded-lg shadow">
          <strong>🧮 Calculated Meter Current:</strong> <span id="calcMeter"></span> A
        </div>
        <div class="bg-yellow-200 py-2 rounded-lg shadow text-yellow-900 font-semibold">
          📉 <strong>Difference (Avg):</strong> <span id="diff"></span> A
        </div>
        <div id="commentBox" class="text-white font-bold py-3 px-4 rounded-lg shadow-lg inline-block mt-4"></div>
      </div>
    </div>

  </div>

  <script>
    function formatDateTime(dt = new Date()) {
      const pad = (n) => String(n).padStart(2, '0');
      return `${pad(dt.getDate())}/${pad(dt.getMonth() + 1)}/${dt.getFullYear()} ${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`;
    }

    function setNow() {
      document.getElementById('dateTime').value = formatDateTime();
    }

    function updateClampLabels() {
      const side = document.getElementById('side').value;
      const clampLabel = document.getElementById('clampLabel');
      if (side === "LT") {
        clampLabel.textContent = "Transformer LT Side Current";
      } else {
        clampLabel.textContent = "Transformer HT Side Current)";
      }
    }

    function getPhaseSum(phase) {
      let sum = 0;
      for (let i = 1; i <= 4; i++) {
        sum += parseFloat(document.getElementById("clamp" + phase + i).value) || 0;
      }
      return sum;
    }

    function resetForm() {
      document.querySelectorAll("input").forEach(el => { if (el.type === "number" || el.type === "text") el.value = ""; });
      document.getElementById('ptRatio').selectedIndex = 0;
      document.getElementById('side').selectedIndex = 0;
      document.getElementById('results').classList.add('hidden');
      updateClampLabels();
      setNow();
    }

    function calculate() {
      const meterNumber = document.getElementById("meterNumber").value.trim();
      if (!meterNumber) {
        alert("⚠️ Meter Number is mandatory!");
        return;
      }

      const billingOMF = parseFloat(document.getElementById("billingOMF").value);
      if (isNaN(billingOMF) || billingOMF <= 0) {
        alert("⚠️ Billing OMF must be a positive number.");
        return;
      }

      const ptRatio = document.getElementById("ptRatio").value;
      const side = document.getElementById("side").value;
      const factors = {
        "11000/110": { LT: 100 / 26.5, HT: 100 },
        "33000/110": { LT: 300 / 79.5, HT: 300 },
        "240/240": { LT: 1, HT: 1 }
      };
      const factor = factors[ptRatio]?.[side];

      // Transformer phase sums
      const clampR = getPhaseSum("R");
      const clampY = getPhaseSum("Y");
      const clampB = getPhaseSum("B");

      // Meter currents (1 per phase)
      const meterValues = [
        parseFloat(document.getElementById("meter1").value) || 0,
        parseFloat(document.getElementById("meter2").value) || 0,
        parseFloat(document.getElementById("meter3").value) || 0
      ];

      // Averages
      const avgClamp = (clampR + clampY + clampB) / 3;
      const avgMeter = (meterValues[0] + meterValues[1] + meterValues[2]) / 3;

      const calcMeterCurrent = avgClamp * factor / billingOMF;
      const difference = avgMeter - calcMeterCurrent;

      let comment = "", classes = "";
      if (Math.abs(difference) < 0.07) {
        comment = "আলহামদুলিল্লাহ, রেশিও এবং ওএমএফ ঠিক আছে";
        classes = "bg-gradient-to-r from-green-500 to-green-700";
      } else if (Math.abs(difference) <= 0.1) {
        comment = "সামান্য একটু পার্থক্য পাওয়া যাচ্ছে, আরেকবার চেক করুন, প্রয়োজনে সিটি/পিটি'র নেমপ্লেট চেক করুন";
        classes = "bg-gradient-to-r from-yellow-400 to-yellow-600 text-yellow-950";
      } else {
        comment = "কাম সারছে, ভালো করে চেক করুন, বিলিং ওএমএফ ঠিক নাই, সিটি/পিটি'র নেমপ্লেট এবং কানেকশন টার্মিনাল এর ছবি নিয়ে রাখুন";
        classes = "bg-gradient-to-r from-red-500 to-red-700";
      }

      // Show results
      document.getElementById("results").classList.remove("hidden");
      document.getElementById("sumClamp").textContent = `R=${clampR.toFixed(2)}, Y=${clampY.toFixed(2)}, B=${clampB.toFixed(2)}`;
      document.getElementById("avgClamp").textContent = avgClamp.toFixed(2);
      document.getElementById("avgMeter").textContent = avgMeter.toFixed(2);
      document.getElementById("calcMeter").textContent = calcMeterCurrent.toFixed(2);
      document.getElementById("diff").textContent = difference.toFixed(2);

      const commentBox = document.getElementById("commentBox");
      commentBox.textContent = comment;
      commentBox.className = `font-bold py-3 px-4 rounded-lg shadow-lg inline-block text-white ${classes}`;
    }

    window.addEventListener('load', () => { setNow(); updateClampLabels(); });
  </script>
</body>
</html>
